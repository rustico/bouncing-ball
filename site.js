function getRandomRange(t,e){return Math.floor(Math.random()*(e-t)+t)}function getRandomInt(){return Math.floor(Math.random())}function getRandomColor(){return"#"+Math.random().toString(16).substr(-6)}function init(){window.requestAnimationFrame(loop),addEvents()}function addEvents(){canvas.addEventListener("mousedown",function(t){var e,a,n=getRandomRange(2,5),o=getRandomRange(2,14),c=document.getElementById("fireAtMousePosition");c.checked?(canvasCoordinates=canvas.getBoundingClientRect(),e=t.clientX-canvasCoordinates.left,a=t.clientY-canvasCoordinates.top,o*=-Math.random()):(e=0,a=canvas.height);var s={x:e,y:a,vx:n,vy:o,canvasBg:canvasBg};0!==t.button&&(s.left=!0),balls.push({id:lastBallID++,element:new BouncingBall(canvas,s)})},!1),canvas.addEventListener("contextmenu",function(t){return t.preventDefault(),!1});var t=document.getElementById("resetCanvas");t.addEventListener("click",resetCanvas),document.getElementById("displayTrajectory").addEventListener("change",toggleTrajectory),document.getElementById("hasWalls").addEventListener("change",toggleWalls)}function loop(){context.clearRect(0,0,canvas.width,canvas.height);var t,e=document.getElementById("hasWalls").checked;balls.forEach(function(a){t=a.element.calculateCoordinates(g,e),null!==t&&a.element.drawTrajectory(t),a.element.draw()}),window.requestAnimationFrame(loop)}function resetCanvas(){balls=[],context.clearRect(0,0,canvas.width,canvas.height),contextBg.clearRect(0,0,canvas.width,canvas.height)}function toggleTrajectory(){toggleClass("canvas-container","showTrajectory","hideTrajectory")}function toggleWalls(){toggleClass("canvas","hideWalls","showWalls")}function toggleClass(t,e,a){var n=document.getElementById(t),o=n.className.indexOf(e);o>=0?(n.className=n.className.replace(e,""),n.className+=a):(n.className=n.className.replace(a,""),n.className+=e)}function BouncingBall(t,e){this.canvas=t,this.context=t.getContext("2d"),this.coordinates=[],e=e||{},this.radius=e.radius||5,this.x0=e.x||0,this.x=this.x0,this.y=e.y||0,this.vy=e.vy||0,this.vx=e.vx||1,this.color=e.color||getRandomColor(),this.left=e.left||!1,this.canvasBg=e.canvasBg||t,this.contextBg=this.canvasBg.getContext("2d")}var canvas=document.getElementById("canvas"),context=canvas.getContext("2d"),canvasBg=document.getElementById("canvas_bg"),contextBg=canvasBg.getContext("2d"),g=.1,balls=[],lastBallID=0;window.onload=init,BouncingBall.prototype.calculateCoordinates=function(t,e){var a=this;if(a.vx<=0)return null;var n={x:a.x,y:a.y};a.coordinates.push(n),a.vy+=t,a.y>a.canvas.height-a.radius?(a.y=a.canvas.height-a.radius,a.vy*=-.7,a.vx-=.01):a.y<=0&&e?(a.y=a.radius,a.vy*=-.8):a.y+=a.vy,a.left?a.x<0&&a.left?(a.x=a.canvas.width,e&&(a.x=a.radius,a.left=!1)):a.x-=a.vx:a.x>a.canvas.width?(a.x=-a.radius,e&&(a.left=!0,a.x=a.canvas.width-a.radius)):a.x+=a.vx;var o={x:a.x,y:a.y};return[n,o]},BouncingBall.prototype.draw=function(){var t=this;t.context.strokeStyle=t.color,t.context.fillStyle=t.color,t.context.beginPath(),t.context.arc(t.x,t.y,t.radius,0,2*Math.PI,!0),t.context.closePath(),t.context.fill()},BouncingBall.prototype.drawTrajectory=function(t){var e=this,a=t[0].x,n=t[0].y,o=t[1].x,c=t[1].y;o>a&&e.left?o=0:a>o&&!e.left&&(o=canvas.width),e.contextBg.strokeStyle=e.color,e.contextBg.beginPath(),e.contextBg.moveTo(a,n),e.contextBg.lineTo(o,c),e.contextBg.stroke(),e.contextBg.closePath()};